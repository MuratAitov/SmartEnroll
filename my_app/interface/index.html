<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Registration | Gonzaga University</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="icon" href="./assets/GU Logo/Gonzaga_Bulldogs_logo.svg.png" type="image/png">
    <link rel="stylesheet" href="./css/component.css">
    <link rel="stylesheet" href="./css/darkmode.css">
    <link rel="stylesheet" href="./css/events.css">
    <link rel="stylesheet" href="./css/forms.css">
    <link rel="stylesheet" href="./css/general.css">
    <link rel="stylesheet" href="./css/interactive.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/misc.css">
    <link rel="stylesheet" href="./css/navigation.css">
    <link rel="stylesheet" href="./css/tables.css">
    <link rel="stylesheet" href="./css/user.css">
    <style>
        /* Styles for the event form in the Events tab */
        .event-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
        }
        
        .day-selection {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
        
        .weekday-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f2f5;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            color: #142A50;
            transition: all 0.2s ease;
        }
        
        .weekday-btn:hover {
            background-color: #e0e4e8;
        }
        
        .weekday-btn.selected {
            background-color: #142A50;
            color: white;
        }
        
        .add-event-btn {
            margin-top: 10px;
            padding: 10px;
            background-color: #142A50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .add-event-btn:hover {
            background-color: #0d1b33;
        }
    </style>
</head>
<body>
    <header>
        <!-- Left section -->
        <div class="header-left">
            <div class="logo">
                <img src="./assets/GU Logo/IMG_4571.jpg" alt="Gonzaga University Logo">
                <div class="logo-text">
                    <span class="university-name">GONZAGA</span>
                    <span class="university-subtitle">UNIVERSITY</span>
                </div>
            </div>
            
            <div class="semester-dropdown">
                <button class="semester-button">Spring 2025 <span class="arrow">▼</span></button>
                <div class="semester-content">
                    <a href="#" onclick="changeSemester('Summer 2025')">Summer 2025</a>
                    <a href="#" onclick="changeSemester('Spring 2025')">Spring 2025</a>
                    <a href="#" onclick="changeSemester('Fall 2024')">Fall 2024</a>
                    <a href="#" onclick="changeSemester('Summer 2024')">Summer 2024</a>
                    <a href="#" onclick="changeSemester('Spring 2024')">Spring 2024</a>
                    <a href="#" onclick="changeSemester('Fall 2023')">Fall 2023</a>
                </div>
            </div>
            
            <div class="credits-display">0 Credits</div>
        </div>
        
        <!-- Center navigation section -->
        <nav class="nav-links">
            <a href="#" data-view="registration" class="active">Registration</a>
            <a href="#" data-view="map">Map</a>
            <a href="#" data-view="finals">Finals</a>
            <a href="#" data-view="rmp">Rate My Professor</a>
            <a href="#" data-view="reflection">Reflection</a>
        </nav>

        <!-- Right section -->
        <div class="header-right">
            <div class="export-container">
                <button class="export-button">
                    Export <span class="arrow">▼</span>
                </button>
                <div class="export-dropdown">
                    <a href="#" onclick="exportToAppleCalendar(); return false;">Export to Apple Calendar</a>
                    <a href="#" onclick="exportToPDF(); return false;">Export to PDF</a>
                    <a href="#" onclick="exportToGoogleCalendar(); return false;">Export to Google Calendar</a>
                </div>
            </div>
            <div class="user-dropdown">
                <button class="nav-button">
                    <img src="./assets/GU Logo/Gonzaga_Bulldogs_logo.svg.png" alt="Bulldog" class="logo-img">
                    <span class="arrow">▼</span>
                </button>
                <div class="dropdown-content" id="userDropdown">
                    <div class="user-info">
                        <div class="student-name">Loading...</div>
                        <div class="student-id">ID: Loading...</div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <button id="themeToggle" class="theme-toggle">Dark Mode</button>
                    <div class="dropdown-divider"></div>
                    <a href="#help">Help</a>
                    <a href="#signout">Sign Out</a>
                </div>
            </div>
        </div>
    </header>

    <main style="display: flex; height: calc(100vh - 60px);">
        <!-- View containers - each will be shown/hidden based on navigation -->
        <div id="registration-view" class="view-container" style="display: flex; width: 100%;">
            <!-- Sidebar - simplified with inline styles for reliability -->
            <div class="sidebar" style="width: 350px; background-color: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: calc(100% - 30px); overflow-y: auto; border-radius: 8px; margin: 15px; display: block !important; min-width: 350px;">
                <div class="tabs" style="display: flex; justify-content: space-between; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; width: 100%; padding: 0;">
                    <button class="tab-button active" onclick="openTab('Courses', event)" style="background: none; border: none; padding: 15px 0; font-weight: 500; cursor: pointer; width: 33.333%; text-align: center; color: #142A50; font-size: 15px; position: relative; margin: 0; box-sizing: border-box;">Courses</button>
                    <button class="tab-button" onclick="openTab('RecurringEvents', event)" style="background: none; border: none; padding: 15px 0; font-weight: 500; cursor: pointer; width: 33.333%; text-align: center; color: #333; font-size: 15px; position: relative; margin: 0; box-sizing: border-box; display: flex; justify-content: center; align-items: center;">Events</button>
                    <button class="tab-button" onclick="openTab('PreReqTree', event)" style="background: none; border: none; padding: 15px 0; font-weight: 500; cursor: pointer; width: 33.333%; text-align: center; color: #333; font-size: 15px; position: relative; margin: 0; box-sizing: border-box;">Pre-Req</button>
                </div>
                
                <div id="Courses" class="tab-content active" style="display: block; width: 100%;">
                    <!-- API Connection Status Indicator -->
                    <div id="connection-status" style="margin-bottom: 15px; padding: 8px 12px; border-radius: 4px; background-color: #f8f9fa; display: flex; align-items: center; justify-content: space-between;">
                        <span>Backend Connection:</span>
                        <span id="connection-indicator" style="padding: 4px 8px; border-radius: 3px; background-color: #f0f0f0; color: #666; font-size: 13px;">Checking...</span>
                    </div>
                    
                    <div class="search-form" style="width: 100%;">
                        <input type="text" placeholder="Subject" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        <input type="text" placeholder="Course code" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <div class="button-group" style="display: flex; gap: 10px; margin-bottom: 15px; width: 100%;">
                            <button type="button" class="filter-button" onclick="toggleFilterButton(this)" style="flex: 1; padding: 12px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">Lower Division</button>
                            <button type="button" class="filter-button" onclick="toggleFilterButton(this)" style="flex: 1; padding: 12px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333;">Upper Division</button>
                        </div>
                        
                        <input type="text" placeholder="Attributes" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <!-- Replace professor dropdown with autocomplete input -->
                        <div class="autocomplete-container" style="width: 100%; position: relative; margin-bottom: 15px;">
                            <input id="instructor-input" type="text" placeholder="Instructor" style="width: 100%; padding: 12px 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                            <div id="instructor-autocomplete" class="autocomplete-list" style="display: none; position: absolute; width: 100%; max-height: 200px; overflow-y: auto; background-color: white; border: 1px solid #e0e4e8; border-radius: 0 0 4px 4px; z-index: 100; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                <!-- Autocomplete suggestions will be added here dynamically -->
                            </div>
                        </div>
                        
                        <input type="text" placeholder="Campus" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        <input type="text" placeholder="Instructional Methods" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <div class="button-group">
                            <button class="search-btn" id="search-courses-btn" type="button">Search Courses</button>
                        </div>
                    </div>
                    
                    <!-- Area to display search results -->
                    <div style="margin-top: 20px; width: 100%;">
                        <h3 style="font-size: 16px; color: #142A50; margin-bottom: 10px;">Available Courses</h3>
                        <ul id="courses-list" style="list-style: none; padding: 0; margin: 0;">
                            <!-- Courses will be populated here -->
                        </ul>
                    </div>
                    
                    <!-- Area to display selected course sections -->
                    <div style="margin-top: 20px; width: 100%;">
                        <h3 style="font-size: 16px; color: #142A50; margin-bottom: 10px;">Course Sections</h3>
                        <ul id="sections-list" style="list-style: none; padding: 0; margin: 0;">
                            <!-- Sections will be populated here -->
                        </ul>
                    </div>
                </div>
                
                <div id="RecurringEvents" class="tab-content" style="display: none; width: 100%;">
                    <div class="search-form" style="width: 100%;">
                        <input type="text" placeholder="Event Name" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <div class="day-selector" style="display: flex; gap: 8px; margin-bottom: 15px; width: 100%;">
                            <button type="button" class="day-button" onclick="toggleDayButton(this)" style="flex: 1; padding: 12px 8px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; text-align: center;">M</button>
                            <button type="button" class="day-button" onclick="toggleDayButton(this)" style="flex: 1; padding: 12px 8px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; text-align: center;">T</button>
                            <button type="button" class="day-button" onclick="toggleDayButton(this)" style="flex: 1; padding: 12px 8px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; text-align: center;">W</button>
                            <button type="button" class="day-button" onclick="toggleDayButton(this)" style="flex: 1; padding: 12px 8px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; text-align: center;">R</button>
                            <button type="button" class="day-button" onclick="toggleDayButton(this)" style="flex: 1; padding: 12px 8px; background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 14px; color: #333; text-align: center;">F</button>
                        </div>
                        
                        <input type="text" placeholder="Start Time" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        <input type="text" placeholder="End Time" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <button type="button" class="search-btn" onclick="addEventFromForm()" style="width: 100%; background-color: #142A50; color: white; border: none; border-radius: 4px; padding: 12px 0; font-size: 14px; cursor: pointer; font-weight: 500;">Add Event</button>
                    </div>
                </div>
                
                <div id="PreReqTree" class="tab-content" style="display: none; width: 100%;">
                    <div class="search-form" style="width: 100%;">
                        <input type="text" placeholder="Enter Course Code (e.g. CPSC 325)" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 15px; color: #333; background-color: white;">
                        
                        <button type="button" class="search-btn" onclick="searchPrerequisites()" style="width: 100%; background-color: #142A50; color: white; border: none; border-radius: 4px; padding: 12px 0; font-size: 14px; cursor: pointer; font-weight: 500;">Search Pre-requisites</button>
                        
                        <div class="sample-courses" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;">
                            <span style="width: 100%; font-size: 14px; color: #666; margin-bottom: 5px;">Try these example courses:</span>
                            <button onclick="document.querySelector('#PreReqTree input').value='CPSC 325'; searchPrerequisites()" style="padding: 8px 12px; background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; cursor: pointer; color: #333; font-weight: 500; min-width: 90px; text-align: center;">CPSC 325</button>
                            <button onclick="document.querySelector('#PreReqTree input').value='CPSC 321'; searchPrerequisites()" style="padding: 8px 12px; background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; cursor: pointer; color: #333; font-weight: 500; min-width: 90px; text-align: center;">CPSC 321</button>
                            <button onclick="document.querySelector('#PreReqTree input').value='MATH 231'; searchPrerequisites()" style="padding: 8px 12px; background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 4px; font-size: 14px; cursor: pointer; color: #333; font-weight: 500; min-width: 90px; text-align: center;">MATH 231</button>
                        </div>
                        
                        <div class="view-options" style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                            <label style="font-size: 14px; color: #666;">View Options:</label>
                            <button onclick="displayInMainArea()" style="padding: 10px; background-color: #f8f8f8; border: 1px solid #d8d8d8; border-radius: 4px; font-size: 14px; color: #333; cursor: pointer; font-weight: 500; display: flex; align-items: center; justify-content: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                                    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                    <path d="M6 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                                Show Full Tree in Main Area
                            </button>
                        </div>
                        
                        <div class="prereq-info" style="color: #333; font-size: 14px; margin-top: 20px; line-height: 1.5; width: 100%; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; background-color: #f9f9f9;">
                            <p style="display: block; margin: 0 0 10px 0; font-weight: 500;">Enter a course code above to see its pre-requisite tree.</p>
                            <p style="font-size: 13px; color: #666; margin: 0;">The prerequisite tree will show you all courses required before taking your selected course, helping you plan your academic path.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content container -->
            <div class="content-container" style="flex: 1; padding: 15px; display: flex;">
                <div id="schedule-container" class="schedule-grid" style="flex: 1; border-radius: 8px; overflow: hidden; background-color: #FFFFFF; box-shadow: 0 1px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column;">
                    <table style="width: 100%; border-collapse: collapse; table-layout: fixed; margin-bottom: 0; flex: 1; height: 100%;">
                        <thead>
                            <tr>
                                <th class="time-header" style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></th>
                                <th style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;">M</th>
                                <th style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;">T</th>
                                <th style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;">W</th>
                                <th style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;">R</th>
                                <th style="background-color: #142A50; color: #ffffff; padding: 10px; font-weight: 500; font-size: 14px; height: 36px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;">F</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">8:00 AM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">9:00 AM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">10:00 AM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">11:00 AM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">12:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">1:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">2:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">3:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">4:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                            <tr><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8; color: #495057; font-size: 13px; font-weight: 500;">5:00 PM</td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td><td style="height: 60px; text-align: center; vertical-align: middle; border: 1px solid #e0e4e8;"></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Map View -->
        <div id="map-view" class="view-container" style="display: none; width: 100%;">
            <div style="width: 100%; padding: 15px; display: flex; height: 100%;">
                <!-- Building blueprints container - LEFT SIDEBAR STYLE -->
                <div style="width: 350px; background-color: white; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: calc(100% - 30px); overflow-y: auto; border-radius: 8px; margin-right: 15px; min-width: 350px;">
                    <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; width: 100%; padding: 0;">
                        <button class="map-tab-button active" onclick="openMapTab('WeekdayTab', event)" style="background: none; border: none; padding: 15px 0; font-weight: 500; cursor: pointer; width: 50%; text-align: center; color: #142A50; font-size: 15px; position: relative; margin: 0; box-sizing: border-box; display: flex; justify-content: center; align-items: center;">Schedule</button>
                        <button class="map-tab-button" onclick="openMapTab('BlueprintsTab', event)" style="background: none; border: none; padding: 15px 0; font-weight: 500; cursor: pointer; width: 50%; text-align: center; color: #333; font-size: 15px; position: relative; margin: 0; box-sizing: border-box; display: flex; justify-content: center; align-items: center;">Building Blueprints</button>
                    </div>
                    
                    <!-- Weekday Schedule Tab Content -->
                    <div id="WeekdayTab" class="map-tab-content active" style="display: block; width: 100%;">
                        <div class="weekday-panels" style="display: flex; flex-direction: column; gap: 5px; width: 100%;">
                            <div class="day-panel" style="border-radius: 4px; overflow: hidden;">
                                <div class="day-header" onclick="toggleDayPanel(this)" style="background-color: #C3415A; color: white; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500;">Monday</span>
                                    <span class="arrow" style="transition: transform 0.3s;">▼</span>
                                </div>
                                <div class="day-content" style="background-color: #f5f5f5; padding: 15px; display: none;">
                                    <p style="margin: 0;">No classes this day!</p>
                                </div>
                            </div>
                            
                            <div class="day-panel" style="border-radius: 4px; overflow: hidden;">
                                <div class="day-header" onclick="toggleDayPanel(this)" style="background-color: #BC2A46; color: white; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500;">Tuesday</span>
                                    <span class="arrow" style="transition: transform 0.3s;">▼</span>
                                </div>
                                <div class="day-content" style="background-color: #f5f5f5; padding: 15px; display: none;">
                                    <p style="margin: 0;">MATH 231 - Calculus (2)</p>
                                </div>
                            </div>
                            
                            <div class="day-panel" style="border-radius: 4px; overflow: hidden;">
                                <div class="day-header" onclick="toggleDayPanel(this)" style="background-color: #B41330; color: white; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500;">Wednesday</span>
                                    <span class="arrow" style="transition: transform 0.3s;">▼</span>
                                </div>
                                <div class="day-content" style="background-color: #f5f5f5; padding: 15px; display: none;">
                                    <p style="margin: 0;">No classes this day!</p>
                                </div>
                            </div>
                            
                            <div class="day-panel" style="border-radius: 4px; overflow: hidden;">
                                <div class="day-header" onclick="toggleDayPanel(this)" style="background-color: #A2102C; color: white; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500;">Thursday</span>
                                    <span class="arrow" style="transition: transform 0.3s;">▼</span>
                                </div>
                                <div class="day-content" style="background-color: #f5f5f5; padding: 15px; display: none;">
                                    <p style="margin: 0;">MATH 231 - Calculus (2)</p>
                                </div>
                            </div>
                            
                            <div class="day-panel" style="border-radius: 4px; overflow: hidden;">
                                <div class="day-header" onclick="toggleDayPanel(this)" style="background-color: #900F26; color: white; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-weight: 500;">Friday</span>
                                    <span class="arrow" style="transition: transform 0.3s;">▼</span>
                                </div>
                                <div class="day-content" style="background-color: #f5f5f5; padding: 15px; display: none;">
                                    <p style="margin: 0;">No classes this day!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Building Blueprints Tab Content -->
                    <div id="BlueprintsTab" class="map-tab-content" style="display: none; width: 100%;">
                        <!-- Building selection buttons -->
                        <div style="margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px;">
                            <button id="Herak" class="building-button" onclick="openHerakPDF()" style="width: 100%; padding: 12px 15px; text-align: left; background-color: white; color: #333; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 15px; font-weight: 500; transition: all 0.2s;">Herak Center</button>
                            <button id="JepsonFirst" class="building-button" onclick="openJepsonFirstFloorPDF()" style="width: 100%; padding: 12px 15px; text-align: left; background-color: white; color: #333; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 15px; font-weight: 500; transition: all 0.2s;">Jepson - First Floor</button>
                            <button id="JepsonBasement" class="building-button" onclick="openJepsonBasementPDF()" style="width: 100%; padding: 12px 15px; text-align: left; background-color: white; color: #333; border: 1px solid #e0e0e0; border-radius: 4px; cursor: pointer; font-size: 15px; font-weight: 500; transition: all 0.2s;">Jepson - Basement</button>
                        </div>
                        
                        <!-- Blueprint viewer -->
                        <div id="blueprint-viewer" style="width: 100%; height: calc(100% - 180px); background-color: white; border: 1px solid #e0e0e0; border-radius: 4px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                            <p style="color: #666; font-size: 14px;">Select a building to view its blueprint</p>
                        </div>
                    </div>
                </div>
                
                <!-- Google Map container - CONTENT CONTAINER STYLE -->
                <div style="flex: 1; border-radius: 8px; overflow: hidden; background-color: #FFFFFF; box-shadow: 0 1px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column;">
                    <div style="flex: 1; padding: 0;">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2689.418973710349!2d-117.40477662402845!3d47.66729508951068!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x549e185c5df3f945%3A0xaf7c8489928f20!2sGonzaga%20University!5e0!3m2!1sen!2sus!4v1716416889721!5m2!1sen!2sus" 
                            width="100%" 
                            height="100%" 
                            style="border: 0;" 
                            allowfullscreen="" 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Finals View -->
        <div id="finals-view" class="view-container" style="display: none; width: 100%;">
            <div style="width: 100%; padding: 20px; text-align: center;">
                <h2>Finals Schedule</h2>
                <div style="max-width: 900px; margin: 0 auto; background-color: #f5f5f5; padding: 20px; border-radius: 8px;">
                    <p>Finals schedule will be displayed here.</p>
                </div>
            </div>
        </div>

        <!-- Rate My Professor View -->
        <div id="rmp-view" class="view-container" style="display: none; width: 100%;">
            <div style="width: 100%; padding: 20px; text-align: center;">
                <h2>Rate My Professor</h2>
                <div style="max-width: 900px; margin: 0 auto; background-color: #f5f5f5; padding: 20px; border-radius: 8px;">
                    <p>Professor ratings and information will be displayed here.</p>
                </div>
            </div>
        </div>

        <!-- Reflection View -->
        <div id="reflection-view" class="view-container" style="display: none; width: 100%;">
            <div style="width: 100%; padding: 20px; text-align: center;">
                <h2>Reflection Tool</h2>
                <div style="max-width: 900px; margin: 0 auto; background-color: #f5f5f5; padding: 20px; border-radius: 8px;">
                    <p>Reflection tools and content will be displayed here.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
    // Simple implementation of the sidebar functions
    function openTab(tabName, event) {
        console.log('Opening tab:', tabName);
        
        // Hide all tab contents
        const tabContents = document.getElementsByClassName("tab-content");
        for (let i = 0; i < tabContents.length; i++) {
            tabContents[i].style.display = "none";
            tabContents[i].classList.remove("active");
        }
        
        // Remove active class from all tab buttons
        const tabButtons = document.getElementsByClassName("tab-button");
        for (let i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove("active");
            tabButtons[i].style.color = "#333";
        }
        
        // Show the selected tab content
        const selectedTab = document.getElementById(tabName);
        if (selectedTab) {
            selectedTab.style.display = "block";
            selectedTab.classList.add("active");
        }
        
        // Add active class to the clicked button
        if (event && event.currentTarget) {
            event.currentTarget.classList.add("active");
            event.currentTarget.style.color = "#142A50";
        }
    }
    
    function toggleFilterButton(button) {
        console.log('Toggling filter button:', button.textContent);
        button.classList.toggle('active');
        
        if (button.classList.contains('active')) {
            button.style.backgroundColor = '#f5f5f5';
            button.style.borderColor = '#142A50';
            button.style.color = '#142A50';
        } else {
            button.style.backgroundColor = 'white';
            button.style.borderColor = '#e0e0e0';
            button.style.color = '#333';
        }
    }
    
    function toggleDayButton(button) {
        console.log('Toggling day button:', button.textContent);
        button.classList.toggle('selected');
        
        if (button.classList.contains('selected')) {
            button.style.backgroundColor = '#142A50';
            button.style.color = 'white';
            button.style.borderColor = '#142A50';
        } else {
            button.style.backgroundColor = 'white';
            button.style.color = '#333';
            button.style.borderColor = '#e0e0e0';
        }
    }
    </script>
    
    <!-- Include scripts in the correct order to prevent initialization conflicts -->
    <script src="./js/theme.js"></script>
    <script src="./js/auth.js"></script>
    <script src="./js/navigation.js"></script>
    <script src="./js/pdfHandling.js"></script>
    <script src="./js/course.js"></script>
    <script src="./js/exportService.js"></script>
    <script src="./js/prereqService.js"></script>
    
    <script>
    // Initialize application components in the correct order
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Main application initialization starting...');
        
        // Initialize theme toggle function if available
        if (typeof initThemeToggle === 'function') {
            initThemeToggle();
        }
        
        // Check if backend connection function is available
        if (typeof checkBackendConnection === 'function') {
            console.log('Backend connection function available, checking connection...');
            checkBackendConnection();
        } else {
            console.warn('Backend connection function not available, using mock data');
            // Add a small delay to ensure scripts have time to load
            setTimeout(function() {
                if (typeof checkBackendConnection === 'function') {
                    console.log('Backend connection function now available, checking connection...');
                    checkBackendConnection();
                } else {
                    console.error('Backend connection function still not available after delay');
                }
            }, 500);
        }
        
        // Check if fetchData function is available for the search button
        const searchButton = document.querySelector('#Courses .search-btn');
        if (searchButton) {
            if (typeof fetchData === 'function') {
                console.log('fetchData function available, setting up event listener');
                searchButton.addEventListener('click', fetchData);
            } else {
                console.error('fetchData function not found');
                // Add a small delay to ensure scripts have time to load
                setTimeout(function() {
                    if (typeof fetchData === 'function') {
                        console.log('fetchData function now available, setting up event listener');
                        searchButton.addEventListener('click', fetchData);
                    } else {
                        console.error('fetchData function still not available after delay');
                        // Fallback to inline handler for search button
                        searchButton.onclick = function() {
                            console.log('Using fallback search function');
                            // Basic fallback for search functionality
                            const criteria = {};
                            const subjectInput = document.querySelector('#Courses input[placeholder="Subject"]');
                            if (subjectInput && subjectInput.value.trim()) {
                                criteria.subject = subjectInput.value.trim().toUpperCase();
                            }
                            
                            const courseCodeInput = document.querySelector('#Courses input[placeholder="Course code"]');
                            if (courseCodeInput && courseCodeInput.value.trim()) {
                                criteria.course_code = courseCodeInput.value.trim();
                            }
                            
                            const instructorInput = document.querySelector('#instructor-input');
                            if (instructorInput && instructorInput.value.trim()) {
                                criteria.instructor = instructorInput.value.trim();
                            }
                            
                            alert('Search functionality requires the course.js script to be properly loaded. Criteria: ' + 
                                JSON.stringify(criteria));
                        };
                    }
                }, 1000);
            }
        }
        
        console.log('Application initialized successfully');
    });
    </script>

    <script>
    // Inline implementation of addEventFromForm to ensure it works
    function addEventFromForm() {
        console.log("Inline addEventFromForm called");
        
        try {
            // Get values from form
            const eventName = document.querySelector('#RecurringEvents input[placeholder="Event Name"]')?.value || "";
            const startTime = document.querySelector('#RecurringEvents input[placeholder="Start Time"]')?.value || "";
            const endTime = document.querySelector('#RecurringEvents input[placeholder="End Time"]')?.value || "";
            
            // Get selected days
            const selectedDays = [];
            document.querySelectorAll('#RecurringEvents .day-button.selected').forEach(btn => {
                const day = btn.textContent.trim();
                if (day) selectedDays.push(day);
            });
            
            // Validation
            if (!eventName) {
                alert("Please enter an event name");
                return;
            }
            
            if (!startTime || !endTime) {
                alert("Please specify both start and end time");
                return;
            }
            
            if (selectedDays.length === 0) {
                alert("Please select at least one day");
                return;
            }
            
            // Format time input
            const formatTimeInput = (timeStr) => {
                if (timeStr.includes(':')) {
                    const [hours, minutes] = timeStr.split(':');
                    return `${hours.padStart(2, '0')}:${minutes.padStart(2, '0')}`;
                } else {
                    const hour = parseInt(timeStr);
                    return isNaN(hour) ? "00:00" : `${hour.toString().padStart(2, '0')}:00`;
                }
            };
            
            const formattedStartTime = formatTimeInput(startTime);
            const formattedEndTime = formatTimeInput(endTime);
            
            // Parse time to grid hours
            const parseTimeToHour = (timeString) => {
                const [hours, minutes] = timeString.split(':').map(Number);
                return hours + (minutes / 60);
            };
            
            const startHour = parseTimeToHour(formattedStartTime);
            const endHour = parseTimeToHour(formattedEndTime);
            
            if (startHour >= endHour) {
                alert("End time must be after start time");
                return;
            }
            
            // Get a random color
            const getRandomColor = () => {
                const colors = ['#4A90E2', '#B41231', '#357ABD', '#002467', '#2ECC71', '#E67E22', '#9B59B6', '#E74C3C', '#1ABC9C'];
                return colors[Math.floor(Math.random() * colors.length)];
            };
            
            const color = getRandomColor();
            
            // Get day index function
            const getDayIndex = (day) => {
                return ['M', 'T', 'W', 'R', 'F'].indexOf(day) + 1;
            };
            
            // Add to grid function
            const addCourseToGrid = (dayIndex, startHour, endHour, courseTitle, location, instructor, color) => {
                const rowStart = Math.floor(startHour) - 8 + 2; // Adjust for header rows and 8am start
                
                if (rowStart < 2 || rowStart > 11) {
                    console.error(`Invalid row start: ${rowStart} for time ${startHour}`);
                    return;
                }
                
                const cell = document.querySelector(`table tr:nth-child(${rowStart}) td:nth-child(${dayIndex + 1})`);
                
                if (!cell) {
                    console.error(`Could not find cell for day ${dayIndex} at time ${startHour}`);
                    return;
                }
                
                // Setup for positioning
                cell.style.position = 'relative';
                
                // Create the event block
                const eventBlock = document.createElement('div');
                eventBlock.className = 'course-block';
                eventBlock.style.position = 'absolute';
                eventBlock.style.backgroundColor = color;
                eventBlock.style.color = 'white';
                eventBlock.style.width = '100%';
                eventBlock.style.left = '0';
                eventBlock.style.padding = '8px';
                eventBlock.style.boxSizing = 'border-box';
                eventBlock.style.borderRadius = '4px';
                eventBlock.style.overflow = 'hidden';
                eventBlock.style.zIndex = '1';
                
                // Calculate position and height
                const startMinutes = (startHour % 1) * 60;
                const endMinutes = (endHour % 1) * 60;
                const durationInMinutes = ((endHour - startHour) * 60);
                
                eventBlock.style.top = `${(startMinutes / 60) * 60}px`;
                eventBlock.style.height = `${durationInMinutes}px`;
                
                // Add content
                eventBlock.innerHTML = `
                    <div style="font-weight: 500; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${courseTitle}</div>
                    <div style="font-size: 0.8em; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${location}</div>
                    <div style="font-size: 0.8em; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${instructor}</div>
                `;
                
                cell.appendChild(eventBlock);
                console.log(`Added event to day ${dayIndex} at time ${startHour}`);
            };
            
            // Ensure we're in the registration view
            const registrationView = document.getElementById('registration-view');
            if (registrationView && !registrationView.classList.contains('active')) {
                document.querySelector('.nav-links a[data-view="registration"]').click();
            }
            
            // Add to grid for each selected day
            selectedDays.forEach(day => {
                const dayIndex = getDayIndex(day);
                if (dayIndex >= 0) {
                    addCourseToGrid(
                        dayIndex,
                        startHour,
                        endHour,
                        eventName,
                        "Personal Event", 
                        "Your Event",
                        color
                    );
                }
            });
            
            // Clear form fields
            document.querySelector('#RecurringEvents input[placeholder="Event Name"]').value = "";
            document.querySelector('#RecurringEvents input[placeholder="Start Time"]').value = "";
            document.querySelector('#RecurringEvents input[placeholder="End Time"]').value = "";
            
            // Reset day buttons
            document.querySelectorAll('#RecurringEvents .day-button.selected').forEach(btn => {
                btn.classList.remove('selected');
                btn.style.backgroundColor = 'white';
                btn.style.color = '#333';
                btn.style.borderColor = '#e0e0e0';
            });
            
            alert(`Added "${eventName}" to your schedule`);
        } catch (error) {
            console.error("Error adding event:", error);
            alert("Failed to add event: " + error.message);
        }
    }
    </script>
</body>
</html> 
